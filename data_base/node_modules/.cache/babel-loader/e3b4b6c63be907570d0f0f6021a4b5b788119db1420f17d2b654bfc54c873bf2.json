{"ast":null,"code":"var _jsxFileName = \"/Users/hiyu/data_base/data_base/src/component/MapComp.js\",\n  _s = $RefreshSig$();\nimport React, { useEffect, useRef, useState } from \"react\";\nimport { MapContainer, TileLayer, Popup, Circle } from \"react-leaflet\";\nimport { Slider, Typography } from '@mui/material';\nimport L from 'leaflet';\nimport 'leaflet/dist/leaflet.css';\nimport { jsxDEV as _jsxDEV } from \"react/jsx-dev-runtime\";\nexport default function MapMarker() {\n  _s();\n  const [year, SetYear] = useState(2000);\n  const [updatedData, SetUpdatedData] = useState(null);\n  const mapRef = useRef(null);\n  const markersRef = useRef([]);\n\n  // WikiDataのSPARQLエンドポイント、LeafletマップのベースURLと設定\n  const endpoint = \"/api/population-data/\";\n  const baseUrl = \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\";\n  const baseAttribution = 'Map data &copy; OpenStreetMap contributors, Tiles Courtesy of OpenStreetMap Japan';\n  const opacity = 0.6;\n  const maxZoom = 5;\n\n  //* dataのフェッチ\n  const fetchData = async () => {\n    const response = await fetch(endpoint);\n    const data = await response.json();\n    return data;\n  };\n  useEffect(() => {\n    // 地図の初期設定（初回のみ実行）\n    if (!mapRef.current) {\n      mapRef.current = L.map('map').setView([20, 0], 2);\n      L.tileLayer(baseUrl, {\n        attribution: baseAttribution,\n        maxZoom\n      }).addTo(mapRef.current);\n    }\n    const updateMarkers = async () => {\n      // const fetch = await fetchData(endpoint, query);\n      // const data = await preprocessData(fetch);\n      const data = fetchData();\n      const yearData = await getData(data, year);\n\n      //* 既存のマーカーを削除\n      markersRef.current.forEach(marker => mapRef.current.removeLayer(marker));\n      markersRef.current = [];\n\n      //* 新しいデータでマーカーを更新\n      Object.keys(yearData).forEach(country => {\n        const countryData = yearData[country];\n        const lat = countryData.lat;\n        const long = countryData.long;\n        const population = countryData.yearPopulation;\n        const radius = countryData.yearRadius;\n        const marker = L.circleMarker([lat, long], {\n          radius,\n          color: \"#007bff\",\n          fillColor: \"#007bff\",\n          fillOpacity: opacity\n        }).bindPopup(`${country}<br>Population: ${population.toLocaleString()}`);\n        marker.addTo(mapRef.current);\n        markersRef.current.push(marker);\n      });\n    };\n    updateMarkers(); // 年が変更されるたびにマーカーを更新\n  }, [year]); // yearが変わるたびに再描画\n\n  return /*#__PURE__*/_jsxDEV(\"div\", {\n    children: [/*#__PURE__*/_jsxDEV(\"div\", {\n      id: \"map\",\n      style: {\n        height: \"90vh\"\n      }\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 72,\n      columnNumber: 13\n    }, this), /*#__PURE__*/_jsxDEV(Typography, {\n      variant: \"h6\",\n      align: \"center\",\n      children: year\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 73,\n      columnNumber: 19\n    }, this), /*#__PURE__*/_jsxDEV(Slider, {\n      value: year,\n      min: 2000,\n      max: 2020,\n      step: 1,\n      onChange: (event, newValue) => SetYear(newValue),\n      \"aria-labelledby\": \"year-slider\",\n      valueLabelDisplay: \"auto\"\n    }, void 0, false, {\n      fileName: _jsxFileName,\n      lineNumber: 76,\n      columnNumber: 13\n    }, this)]\n  }, void 0, true, {\n    fileName: _jsxFileName,\n    lineNumber: 71,\n    columnNumber: 11\n  }, this);\n}\n_s(MapMarker, \"e0OGtpYkaRHee2OhZ1abtKa1i/U=\");\n_c = MapMarker;\nvar _c;\n$RefreshReg$(_c, \"MapMarker\");","map":{"version":3,"names":["React","useEffect","useRef","useState","MapContainer","TileLayer","Popup","Circle","Slider","Typography","L","jsxDEV","_jsxDEV","MapMarker","_s","year","SetYear","updatedData","SetUpdatedData","mapRef","markersRef","endpoint","baseUrl","baseAttribution","opacity","maxZoom","fetchData","response","fetch","data","json","current","map","setView","tileLayer","attribution","addTo","updateMarkers","yearData","getData","forEach","marker","removeLayer","Object","keys","country","countryData","lat","long","population","yearPopulation","radius","yearRadius","circleMarker","color","fillColor","fillOpacity","bindPopup","toLocaleString","push","children","id","style","height","fileName","_jsxFileName","lineNumber","columnNumber","variant","align","value","min","max","step","onChange","event","newValue","valueLabelDisplay","_c","$RefreshReg$"],"sources":["/Users/hiyu/data_base/data_base/src/component/MapComp.js"],"sourcesContent":["import React, {useEffect, useRef, useState} from \"react\";\r\nimport {MapContainer, TileLayer, Popup, Circle} from \"react-leaflet\";\r\n\r\nimport {Slider, Typography} from '@mui/material';\r\nimport L from 'leaflet';\r\nimport 'leaflet/dist/leaflet.css';\r\n\r\nexport default function MapMarker() {\r\n    const [year, SetYear] = useState(2000);\r\n    const [updatedData, SetUpdatedData] = useState(null);\r\n    const mapRef = useRef(null);\r\n    const markersRef = useRef([]);\r\n    \r\n    // WikiDataのSPARQLエンドポイント、LeafletマップのベースURLと設定\r\n    const endpoint = \"/api/population-data/\";\r\n    const baseUrl = \"https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png\";\r\n    const baseAttribution = 'Map data &copy; OpenStreetMap contributors, Tiles Courtesy of OpenStreetMap Japan';\r\n    const opacity = 0.6;\r\n    const maxZoom = 5;\r\n    \r\n\r\n    //* dataのフェッチ\r\n    const fetchData = async () => {\r\n        const response = await fetch(endpoint);\r\n        const data = await response.json();\r\n        return data;\r\n    };\r\n\r\n\r\n    useEffect(() => {\r\n        // 地図の初期設定（初回のみ実行）\r\n        if (!mapRef.current) {\r\n          mapRef.current = L.map('map').setView([20, 0], 2);\r\n          L.tileLayer(baseUrl, { attribution: baseAttribution, maxZoom }).addTo(mapRef.current);\r\n        }\r\n        \r\n        const updateMarkers = async () => {\r\n            // const fetch = await fetchData(endpoint, query);\r\n            // const data = await preprocessData(fetch);\r\n            const data = fetchData();\r\n            const yearData = await getData(data, year);\r\n\r\n            //* 既存のマーカーを削除\r\n            markersRef.current.forEach(marker => mapRef.current.removeLayer(marker));\r\n            markersRef.current = [];\r\n\r\n            //* 新しいデータでマーカーを更新\r\n            Object.keys(yearData).forEach(country => {\r\n                const countryData = yearData[country];\r\n                const lat = countryData.lat;\r\n                const long = countryData.long;\r\n                const population = countryData.yearPopulation;\r\n                const radius = countryData.yearRadius;\r\n                \r\n                const marker = L.circleMarker([lat, long], {\r\n                    radius,\r\n                    color: \"#007bff\",\r\n                    fillColor: \"#007bff\",\r\n                    fillOpacity: opacity\r\n                  }).bindPopup(`${country}<br>Population: ${population.toLocaleString()}`);\r\n                  \r\n                  marker.addTo(mapRef.current);\r\n                  markersRef.current.push(marker);\r\n            });\r\n          };\r\n      \r\n          updateMarkers(); // 年が変更されるたびにマーカーを更新\r\n        }, [year]); // yearが変わるたびに再描画\r\n      \r\n        return (\r\n          <div>\r\n            <div id=\"map\" style={{ height: \"90vh\" }} />\r\n                  <Typography variant=\"h6\" align=\"center\">\r\n              {year}\r\n            </Typography>\r\n            <Slider\r\n              value={year}\r\n              min={2000}\r\n              max={2020}\r\n              step={1}\r\n              onChange={(event, newValue) => SetYear(newValue)}\r\n              aria-labelledby=\"year-slider\"\r\n              valueLabelDisplay=\"auto\"\r\n            />\r\n          </div>\r\n        );\r\n    }\r\n"],"mappings":"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","ignoreList":[]},"metadata":{},"sourceType":"module","externalDependencies":[]}